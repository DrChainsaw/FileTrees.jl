<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
   <link rel="stylesheet" href="/FileTrees.jl/libs/highlight/github.min.css">
   
  <link rel="stylesheet" href="/FileTrees.jl/css/franklin.css">
<link rel="stylesheet" href="/FileTrees.jl/css/poole_hyde.css">
<link rel="stylesheet" href="/FileTrees.jl/css/custom.css">
<!-- style adjustments -->
<style>
  html {font-size: 17px;}
  .franklin-content {position: relative; padding-left: 8%; padding-right: 5%; line-height: 1.35em;}
  @media (min-width: 940px) {
    .franklin-content {width: 100%; margin-left: auto; margin-right: auto;}
  }
  @media (max-width: 768px) {
    .franklin-content {padding-left: 6%; padding-right: 6%;}
  }
</style>
<link rel="icon" href="/FileTrees.jl/assets/favicon.png">

   <title>FileTrees.jl</title>  
</head>
<body>
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1 style="font-size:2em"><a href="/FileTrees.jl/">FileTrees<span style="opacity:0.4">.jl</span></a></h1>
      <p class="lead">Easy parallel file loading</p>
    </div>
    <nav class="sidebar-nav">
      <a class="sidebar-nav-item " href="/FileTrees.jl/">Home</a>
      <a class="sidebar-nav-item " href="/FileTrees.jl/api/">Full API</a>
    </nav>

  </div>
  <div style="font-size: 0.85em; bottom: 3em; position: fixed">
      <img src="https://raw.githubusercontent.com/JuliaLang/julia-logo-graphics/master/images/julia-logo-dark.svg" height="32" style="display: inline-block; margin-bottom: -8px; opacity: 0.7">
      powered.
  </div>
</div>
<div class="content container">

<!-- Content appended here -->
<div class="franklin-content"><h1 id="values_in_file_trees"><a href="#values_in_file_trees">Values in file trees</a></h1>
<p>And how to work with them.</p>
<h2 id="loading_values"><a href="#loading_values">loading values</a></h2>
<p><a href="/FileTrees.jl/api/#load"><code>FileTrees.load</code></a> can be used to load values into a tree.</p>
<pre><code class="julia hljs"><span class="hljs-keyword">using</span> DataFrames, CSV, FileTrees

taxi_dir = FileTree(<span class="hljs-string">&quot;taxi-data&quot;</span>)

dfs = FileTrees.load(taxi_dir) <span class="hljs-keyword">do</span> file
    DataFrame(CSV.File(path(file)))
<span class="hljs-keyword">end</span></code></pre><pre><code class="plaintext hljs">taxi-data/
├─ 2019/
│  ├─ 01/
│  │  ├─ green.csv (9×20 DataFrame)
│  │  └─ yellow.csv (9×18 DataFrame)
│  └─ 02/
│     ├─ green.csv (9×20 DataFrame)
│     └─ yellow.csv (9×18 DataFrame)
└─ 2020/
   ├─ 01/
   │  ├─ green.csv (9×20 DataFrame)
   │  └─ yellow.csv (9×18 DataFrame)
   └─ 02/
      ├─ green.csv (9×20 DataFrame)
      └─ yellow.csv (9×18 DataFrame)
</code></pre>
<p>It&#39;s probably obvious, but you can load any file type and even values that have nothing to do with the file.</p>
<p>Loading can be made lazy using the <code>lazy&#61;true</code> flag. More on laziness <a href="/FileTrees.jl/lazy-parallel/">here</a>.</p>
<pre><code class="julia hljs">lazy_dfs = FileTrees.load(taxi_dir; lazy=<span class="hljs-literal">true</span>) <span class="hljs-keyword">do</span> file
    DataFrame(CSV.File(path(file)))
<span class="hljs-keyword">end</span></code></pre><pre><code class="plaintext hljs">taxi-data/
├─ 2019/
│  ├─ 01/
│  │  ├─ green.csv (Dagger.Thunk)
│  │  └─ yellow.csv (Dagger.Thunk)
│  └─ 02/
│     ├─ green.csv (Dagger.Thunk)
│     └─ yellow.csv (Dagger.Thunk)
└─ 2020/
   ├─ 01/
   │  ├─ green.csv (Dagger.Thunk)
   │  └─ yellow.csv (Dagger.Thunk)
   └─ 02/
      ├─ green.csv (Dagger.Thunk)
      └─ yellow.csv (Dagger.Thunk)
</code></pre>
<p>Below we will see the effect of each value-manipulating function when called with both lazy and non-lazy trees.</p>
<h2 id="mapvalues"><a href="#mapvalues">mapvalues</a></h2>
<p><code>mapvalues&#40;f, t::FileTree&#41;</code> applies <code>f</code> to every node in <code>t</code> which has a value loaded into it. It returns a new tree with the resultant values in place of the original ones.</p>
<p>Let&#39;s drop all but the first 5 columns of the dataframes we have loaded:</p>
<pre><code class="julia hljs">mapvalues(df-&gt;df[:, <span class="hljs-number">1</span>:<span class="hljs-number">5</span>], dfs)</code></pre><pre><code class="plaintext hljs">taxi-data/
├─ 2019/
│  ├─ 01/
│  │  ├─ green.csv (9×5 DataFrame)
│  │  └─ yellow.csv (9×5 DataFrame)
│  └─ 02/
│     ├─ green.csv (9×5 DataFrame)
│     └─ yellow.csv (9×5 DataFrame)
└─ 2020/
   ├─ 01/
   │  ├─ green.csv (9×5 DataFrame)
   │  └─ yellow.csv (9×5 DataFrame)
   └─ 02/
      ├─ green.csv (9×5 DataFrame)
      └─ yellow.csv (9×5 DataFrame)
</code></pre>
<p>mapvalues on a lazy tree creates a lazy tree, where the values on <code>exec</code> will be the right computed values.</p>
<pre><code class="julia hljs">mapvalues(df-&gt;df[:, <span class="hljs-number">1</span>:<span class="hljs-number">5</span>], lazy_dfs)</code></pre><pre><code class="plaintext hljs">taxi-data/
├─ 2019/
│  ├─ 01/
│  │  ├─ green.csv (Dagger.Thunk)
│  │  └─ yellow.csv (Dagger.Thunk)
│  └─ 02/
│     ├─ green.csv (Dagger.Thunk)
│     └─ yellow.csv (Dagger.Thunk)
└─ 2020/
   ├─ 01/
   │  ├─ green.csv (Dagger.Thunk)
   │  └─ yellow.csv (Dagger.Thunk)
   └─ 02/
      ├─ green.csv (Dagger.Thunk)
      └─ yellow.csv (Dagger.Thunk)
</code></pre>
<pre><code class="julia hljs">exec(mapvalues(df-&gt;df[:, <span class="hljs-number">1</span>:<span class="hljs-number">5</span>], lazy_dfs))</code></pre><pre><code class="plaintext hljs">taxi-data/
├─ 2019/
│  ├─ 01/
│  │  ├─ green.csv (9×5 DataFrame)
│  │  └─ yellow.csv (9×5 DataFrame)
│  └─ 02/
│     ├─ green.csv (9×5 DataFrame)
│     └─ yellow.csv (9×5 DataFrame)
└─ 2020/
   ├─ 01/
   │  ├─ green.csv (9×5 DataFrame)
   │  └─ yellow.csv (9×5 DataFrame)
   └─ 02/
      ├─ green.csv (9×5 DataFrame)
      └─ yellow.csv (9×5 DataFrame)
</code></pre>
<h2 id="reducevalues"><a href="#reducevalues">reducevalues</a></h2>
<p><code>reducevalues&#40;f, t::FileTree&#41;</code> reduce all nodes in <code>t</code> into a single value by successively applying <code>f</code>. <code>f</code> is assumed to be <a href="https://en.wikipedia.org/wiki/Associative_property">associative</a> and an ordering that is optimal for parallelism is chosen. If <code>f</code> is not <code>associative</code>, pass <code>associative&#61;false</code> keyword argument.</p>
<p>Let&#39;s use reducevalues to combine the yellow.csv 5-column dataframes.</p>
<pre><code class="julia hljs">mapvalues(df-&gt;df[:, <span class="hljs-number">1</span>:<span class="hljs-number">5</span>], dfs[<span class="hljs-string">r&quot;yellow.csv$&quot;</span>])</code></pre><pre><code class="plaintext hljs">taxi-data/
├─ 2019/
│  ├─ 01/
│  │  └─ yellow.csv (9×5 DataFrame)
│  └─ 02/
│     └─ yellow.csv (9×5 DataFrame)
└─ 2020/
   ├─ 01/
   │  └─ yellow.csv (9×5 DataFrame)
   └─ 02/
      └─ yellow.csv (9×5 DataFrame)
</code></pre>
<p>mapvalues on a lazy tree creates a lazy tree, where the values on <code>exec</code> will be the right computed values.</p>
<pre><code class="julia hljs">mapvalues(df-&gt;df[:, <span class="hljs-number">1</span>:<span class="hljs-number">5</span>], lazy_dfs)</code></pre><pre><code class="plaintext hljs">taxi-data/
├─ 2019/
│  ├─ 01/
│  │  ├─ green.csv (Dagger.Thunk)
│  │  └─ yellow.csv (Dagger.Thunk)
│  └─ 02/
│     ├─ green.csv (Dagger.Thunk)
│     └─ yellow.csv (Dagger.Thunk)
└─ 2020/
   ├─ 01/
   │  ├─ green.csv (Dagger.Thunk)
   │  └─ yellow.csv (Dagger.Thunk)
   └─ 02/
      ├─ green.csv (Dagger.Thunk)
      └─ yellow.csv (Dagger.Thunk)
</code></pre>
<pre><code class="julia hljs">exec(mapvalues(df-&gt;df[:, <span class="hljs-number">1</span>:<span class="hljs-number">5</span>], lazy_dfs))</code></pre><pre><code class="plaintext hljs">taxi-data/
├─ 2019/
│  ├─ 01/
│  │  ├─ green.csv (9×5 DataFrame)
│  │  └─ yellow.csv (9×5 DataFrame)
│  └─ 02/
│     ├─ green.csv (9×5 DataFrame)
│     └─ yellow.csv (9×5 DataFrame)
└─ 2020/
   ├─ 01/
   │  ├─ green.csv (9×5 DataFrame)
   │  └─ yellow.csv (9×5 DataFrame)
   └─ 02/
      ├─ green.csv (9×5 DataFrame)
      └─ yellow.csv (9×5 DataFrame)
</code></pre>
<h2 id="mapsubtrees_value_operations"><a href="#mapsubtrees_value_operations">mapsubtrees &#43; value operations</a></h2>
<div class="page-foot">
  <div class="copyright">
    &copy; Shashi Gowda, Julian Samaroo. Last modified: August 10, 2020. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a>.
  </div>
</div>
</div><!-- CONTENT ENDS HERE -->
    </div>  <!-- div: content container -->
    
    
        


    
  </body>
</html>
