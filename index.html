<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
   <link rel="stylesheet" href="/FileTrees.jl/libs/highlight/github.min.css">
   
  <link rel="stylesheet" href="/FileTrees.jl/css/franklin.css">
<link rel="stylesheet" href="/FileTrees.jl/css/poole_hyde.css">
<link rel="stylesheet" href="/FileTrees.jl/css/custom.css">
<!-- style adjustments -->
<style>
  html {font-size: 17px;}
  .franklin-content {position: relative; padding-left: 8%; padding-right: 5%; line-height: 1.35em;}
  @media (min-width: 940px) {
    .franklin-content {width: 100%; margin-left: auto; margin-right: auto;}
  }
  @media (max-width: 768px) {
    .franklin-content {padding-left: 6%; padding-right: 6%;}
  }
</style>
<link rel="icon" href="/FileTrees.jl/assets/favicon.png">

   <title>FileTrees.jl</title>  
</head>
<body>
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1 style="font-size:2em"><a href="/FileTrees.jl/">FileTrees<span style="opacity:0.4">.jl</span></a></h1>
      <p class="lead">Easy parallel file loading</p>
    </div>
    <style>
@media (min-width: 768px) {
    .sidebar-nav {
        margin-top: 3em;
    }
}
    .sidebar-nav .sidebar-nav-item.active {
        box-sizing: border-box;
        border-bottom: 1px #f1f1f1 solid;
        margin-right: -1em;
        margin-left: -0.5em;
        padding-left: 0.5em;
        color: white;
        font-weight: normal !important;
    }
    .sidebar-nav .sidebar-nav-item {
        color: #cccccc;
        margin: 0.5em 0;
    }
    </style>
    <nav class="sidebar-nav" style="opacity: 0.9">
      <a class="sidebar-nav-item active" href="/FileTrees.jl/">Home page</a>
      <a class="sidebar-nav-item " href="/FileTrees.jl/create-trees/">Creating file trees</a>
      <a class="sidebar-nav-item " href="/FileTrees.jl/values/">File processing</a>
      <a class="sidebar-nav-item " href="/FileTrees.jl/patterns/">Pattern matching</a>
      <a class="sidebar-nav-item " href="/FileTrees.jl/tree-manipulation/">Manipulating file trees</a>
      <a class="sidebar-nav-item " href="/FileTrees.jl/lazy-parallel/">Laziness and parallelism</a>
      <a class="sidebar-nav-item " href="/FileTrees.jl/api/">API documentation</a>
    </nav>

  </div>
  <div style="font-size: 0.85em; bottom: 3em; position: fixed">
      <a href="https://github.com/shashi/FileTrees.jl">Go to GitHub repository &rarr;</a> <br>  <br>

      <a href="https://julialang.org/"><img src="https://raw.githubusercontent.com/JuliaLang/julia-logo-graphics/master/images/julia-logo-dark.svg" height="32" style="display: inline-block; margin-bottom: -8px; opacity: 0.7">
          powered.</a>
  </div>
</div>
<div class="content container">

<!-- Content appended here -->
<div class="franklin-content">
<h1>FileTrees.jl &mdash; overview</h1>
<p style="font-size: 1.15em; color: #666; line-height:1.5em">
FileTrees is a set of tools to lazy-load, process and write file trees. Built-in parallelism allows you to max out compute on any machine.
</p>

<p>Tree operations let you freely restructure file trees in memory so as to be convenient to set up computations. Files in a file tree can have any value attached to them &#40;not necessarily those loaded from the file itself&#41;, you can map and reduce over these values, or combine them by merging or collapsing trees or subtrees.</p>
<p><strong>On this website</strong></p>

<ul>
<li><a href="create-trees/">Creating file trees</a></li>
<li><a href="values/">Values in file trees: file loading etc.</a></li>
<li><a href="patterns/">Pattern matching on paths</a></li>
<li><a href="tree-manipulation/">Manipulating file trees</a></li>
<li><a href="lazy-parallel/">Lazy values and parallelism</a></li>
<li><a href="api/">API documentation</a></li>
</ul>

<p><strong>In this article</strong></p>
<p>We will look at a brief walk through of some of the most important functionality in this article using an example dataset.</p>
<div class="franklin-toc"><ol><li><a href="#loading_directories">Loading directories</a></li><li><a href="#looking_files_up">Looking files up</a></li><li><a href="#reducing_values_in_trees">reducing values in trees</a></li><li><a href="#saving_to_a_directory">Saving to a directory</a></li></ol></div>
<h1 id="loading_directories"><a href="#loading_directories">Loading directories</a></h1>
<p>The basic datastructure in FileTrees is the <a href="api/#FileTree"><code>FileTree</code></a>.</p>
<p>Calling <code>FileTree</code> with a directory name will walk the directory on disk and construct a <code>FileTree</code>.</p>
<pre><code class="julia hljs"><span class="hljs-keyword">using</span> FileTrees

taxi_dir = FileTree(<span class="hljs-string">&quot;taxi-data&quot;</span>)</code></pre><pre><code class="plaintext hljs">taxi-data/
├─ 2019/
│  ├─ 01/
│  │  ├─ green.csv
│  │  └─ yellow.csv
│  └─ 02/
│     ├─ green.csv
│     └─ yellow.csv
└─ 2020/
   ├─ 01/
   │  ├─ green.csv
   │  └─ yellow.csv
   └─ 02/
      ├─ green.csv
      └─ yellow.csv
</code></pre>
<p>The files in the directory can be loaded using the <a href="api/#load"><code>load</code></a> function. Here we will use CSV and DataFrames to load the csv files.</p>
<pre><code class="julia hljs"><span class="hljs-keyword">using</span> DataFrames, CSV

dfs = FileTrees.load(taxi_dir) <span class="hljs-keyword">do</span> file
    DataFrame(CSV.File(path(file)))
<span class="hljs-keyword">end</span></code></pre><pre><code class="plaintext hljs">taxi-data/
├─ 2019/
│  ├─ 01/
│  │  ├─ green.csv (9×20 DataFrame)
│  │  └─ yellow.csv (9×18 DataFrame)
│  └─ 02/
│     ├─ green.csv (9×20 DataFrame)
│     └─ yellow.csv (9×18 DataFrame)
└─ 2020/
   ├─ 01/
   │  ├─ green.csv (9×20 DataFrame)
   │  └─ yellow.csv (9×18 DataFrame)
   └─ 02/
      ├─ green.csv (9×20 DataFrame)
      └─ yellow.csv (9×18 DataFrame)
</code></pre>
<p>A summary of the value loaded into each file is shown in parentheses. The <code>file</code> argument passed to the load callback is a <code>File</code> object. It supports the <a href="api/#name"><code>name</code></a>, <a href="api/#path"><code>path</code></a> and <a href="api/#parent"><code>parent</code></a> functions.</p>
<p><code>load</code> returns a new <code>FileTree</code> which has the same structure as before, but contains the loaded data in each <code>File</code> node.</p>
<p>Here <code>load</code> actually read the files eagerly. This may not be feasible if the files contain data that is too big to fit in memory.</p>
<p>In such a case, you can load the files lazily using <code>lazy&#61;true</code></p>
<pre><code class="julia hljs">lazy_dfs = FileTrees.load(taxi_dir; lazy=<span class="hljs-literal">true</span>) <span class="hljs-keyword">do</span> file
    DataFrame(CSV.File(path(file)))
<span class="hljs-keyword">end</span></code></pre><pre><code class="plaintext hljs">taxi-data/
├─ 2019/
│  ├─ 01/
│  │  ├─ green.csv (Dagger.Thunk)
│  │  └─ yellow.csv (Dagger.Thunk)
│  └─ 02/
│     ├─ green.csv (Dagger.Thunk)
│     └─ yellow.csv (Dagger.Thunk)
└─ 2020/
   ├─ 01/
   │  ├─ green.csv (Dagger.Thunk)
   │  └─ yellow.csv (Dagger.Thunk)
   └─ 02/
      ├─ green.csv (Dagger.Thunk)
      └─ yellow.csv (Dagger.Thunk)
</code></pre>
<p>As you can see the nodes have the value of type <code>Dagger.Thunk</code> – this represents a lazy task that can later be executed using the <a href="api/#exec"><code>exec</code></a> function. You can continue to use most of the functions in this package without worrying about whether the input tree has lazy values or not. You will get the corresponding lazy outputs wherever the input trees had lazy values. Lazy values also encode dependency between them, hence making it possible for <code>exec</code> to compute them in parallel.</p>
<p>To know more details about the usage of laziness and parallelism, go to <a href="lazy-parallel/">this article</a>.</p>
<h1 id="looking_files_up"><a href="#looking_files_up">Looking files up</a></h1>
<p>Let&#39;s look at one of these DataFrames by indexing into the tree with the path to a file, namely <code>&quot;2020/01/yellow.csv&quot;</code>.</p>
<pre><code class="julia hljs">yellow_jan_20 = dfs[<span class="hljs-string">&quot;2020/01/yellow.csv&quot;</span>]</code></pre><pre><code class="plaintext hljs">File(taxi-data/2020/01/yellow.csv)</code></pre>
<p><code>file&#91;&#93;</code> syntax fetches the value stored in a <code>File</code> or <code>FileTree</code> node:</p>
<pre><code class="julia hljs">yellow_jan_20[] <span class="hljs-comment"># file[] gets the value</span></code></pre><pre><code class="plaintext hljs">9×18 DataFrame
│ Row │ VendorID │ tpep_pickup_datetime │ tpep_dropoff_datetime │ passenger_count │ trip_distance │ RatecodeID │ store_and_fwd_flag │ PULocationID │ DOLocationID │ payment_type │ fare_amount │ extra   │ mta_tax │ tip_amount │ tolls_amount │ improvement_surcharge │ total_amount │ congestion_surcharge │
│     │ Int64    │ String               │ String                │ Int64           │ Float64       │ Int64      │ String             │ Int64        │ Int64        │ Int64        │ Float64     │ Float64 │ Float64 │ Float64    │ Int64        │ Float64               │ Float64      │ Float64              │
├─────┼──────────┼──────────────────────┼───────────────────────┼─────────────────┼───────────────┼────────────┼────────────────────┼──────────────┼──────────────┼──────────────┼─────────────┼─────────┼─────────┼────────────┼──────────────┼───────────────────────┼──────────────┼──────────────────────┤
│ 1   │ 1        │ 2020-01-01 00:28:15  │ 2020-01-01 00:33:03   │ 1               │ 1.2           │ 1          │ N                  │ 238          │ 239          │ 1            │ 6.0         │ 3.0     │ 0.5     │ 1.47       │ 0            │ 0.3                   │ 11.27        │ 2.5                  │
│ 2   │ 1        │ 2020-01-01 00:35:39  │ 2020-01-01 00:43:04   │ 1               │ 1.2           │ 1          │ N                  │ 239          │ 238          │ 1            │ 7.0         │ 3.0     │ 0.5     │ 1.5        │ 0            │ 0.3                   │ 12.3         │ 2.5                  │
│ 3   │ 1        │ 2020-01-01 00:47:41  │ 2020-01-01 00:53:52   │ 1               │ 0.6           │ 1          │ N                  │ 238          │ 238          │ 1            │ 6.0         │ 3.0     │ 0.5     │ 1.0        │ 0            │ 0.3                   │ 10.8         │ 2.5                  │
│ 4   │ 1        │ 2020-01-01 00:55:23  │ 2020-01-01 01:00:14   │ 1               │ 0.8           │ 1          │ N                  │ 238          │ 151          │ 1            │ 5.5         │ 0.5     │ 0.5     │ 1.36       │ 0            │ 0.3                   │ 8.16         │ 0.0                  │
│ 5   │ 2        │ 2020-01-01 00:01:58  │ 2020-01-01 00:04:16   │ 1               │ 0.0           │ 1          │ N                  │ 193          │ 193          │ 2            │ 3.5         │ 0.5     │ 0.5     │ 0.0        │ 0            │ 0.3                   │ 4.8          │ 0.0                  │
│ 6   │ 2        │ 2020-01-01 00:09:44  │ 2020-01-01 00:10:37   │ 1               │ 0.03          │ 1          │ N                  │ 7            │ 193          │ 2            │ 2.5         │ 0.5     │ 0.5     │ 0.0        │ 0            │ 0.3                   │ 3.8          │ 0.0                  │
│ 7   │ 2        │ 2020-01-01 00:39:25  │ 2020-01-01 00:39:29   │ 1               │ 0.0           │ 1          │ N                  │ 193          │ 193          │ 1            │ 2.5         │ 0.5     │ 0.5     │ 0.01       │ 0            │ 0.3                   │ 3.81         │ 0.0                  │
│ 8   │ 2        │ 2019-12-18 15:27:49  │ 2019-12-18 15:28:59   │ 1               │ 0.0           │ 5          │ N                  │ 193          │ 193          │ 1            │ 0.01        │ 0.0     │ 0.0     │ 0.0        │ 0            │ 0.3                   │ 2.81         │ 2.5                  │
│ 9   │ 2        │ 2019-12-18 15:30:35  │ 2019-12-18 15:31:35   │ 4               │ 0.0           │ 1          │ N                  │ 193          │ 193          │ 1            │ 2.5         │ 0.5     │ 0.5     │ 0.0        │ 0            │ 0.3                   │ 6.3          │ 2.5                  │</code></pre>
<p>When a tree is lazy, the <code>&#91;&#93;</code> operation returns a <code>Thunk</code>, a delayed computation.</p>
<p>You can call <code>exec</code> on the this value to compute and fetch the value.</p>
<pre><code class="julia hljs">val = lazy_dfs[<span class="hljs-string">&quot;2020/01/yellow.csv&quot;</span>][]
<span class="hljs-meta">@show</span> typeof(val)
<span class="hljs-meta">@show</span> exec(val);</code></pre><pre><code class="plaintext hljs">typeof(val) = Dagger.Thunk
exec(val) = 9×18 DataFrame
│ Row │ VendorID │ tpep_pickup_datetime │ tpep_dropoff_datetime │ passenger_count │ trip_distance │ RatecodeID │ store_and_fwd_flag │ PULocationID │ DOLocationID │ payment_type │ fare_amount │ extra   │ mta_tax │ tip_amount │ tolls_amount │ improvement_surcharge │ total_amount │ congestion_surcharge │
│     │ Int64    │ String               │ String                │ Int64           │ Float64       │ Int64      │ String             │ Int64        │ Int64        │ Int64        │ Float64     │ Float64 │ Float64 │ Float64    │ Int64        │ Float64               │ Float64      │ Float64              │
├─────┼──────────┼──────────────────────┼───────────────────────┼─────────────────┼───────────────┼────────────┼────────────────────┼──────────────┼──────────────┼──────────────┼─────────────┼─────────┼─────────┼────────────┼──────────────┼───────────────────────┼──────────────┼──────────────────────┤
│ 1   │ 1        │ 2020-01-01 00:28:15  │ 2020-01-01 00:33:03   │ 1               │ 1.2           │ 1          │ N                  │ 238          │ 239          │ 1            │ 6.0         │ 3.0     │ 0.5     │ 1.47       │ 0            │ 0.3                   │ 11.27        │ 2.5                  │
│ 2   │ 1        │ 2020-01-01 00:35:39  │ 2020-01-01 00:43:04   │ 1               │ 1.2           │ 1          │ N                  │ 239          │ 238          │ 1            │ 7.0         │ 3.0     │ 0.5     │ 1.5        │ 0            │ 0.3                   │ 12.3         │ 2.5                  │
│ 3   │ 1        │ 2020-01-01 00:47:41  │ 2020-01-01 00:53:52   │ 1               │ 0.6           │ 1          │ N                  │ 238          │ 238          │ 1            │ 6.0         │ 3.0     │ 0.5     │ 1.0        │ 0            │ 0.3                   │ 10.8         │ 2.5                  │
│ 4   │ 1        │ 2020-01-01 00:55:23  │ 2020-01-01 01:00:14   │ 1               │ 0.8           │ 1          │ N                  │ 238          │ 151          │ 1            │ 5.5         │ 0.5     │ 0.5     │ 1.36       │ 0            │ 0.3                   │ 8.16         │ 0.0                  │
│ 5   │ 2        │ 2020-01-01 00:01:58  │ 2020-01-01 00:04:16   │ 1               │ 0.0           │ 1          │ N                  │ 193          │ 193          │ 2            │ 3.5         │ 0.5     │ 0.5     │ 0.0        │ 0            │ 0.3                   │ 4.8          │ 0.0                  │
│ 6   │ 2        │ 2020-01-01 00:09:44  │ 2020-01-01 00:10:37   │ 1               │ 0.03          │ 1          │ N                  │ 7            │ 193          │ 2            │ 2.5         │ 0.5     │ 0.5     │ 0.0        │ 0            │ 0.3                   │ 3.8          │ 0.0                  │
│ 7   │ 2        │ 2020-01-01 00:39:25  │ 2020-01-01 00:39:29   │ 1               │ 0.0           │ 1          │ N                  │ 193          │ 193          │ 1            │ 2.5         │ 0.5     │ 0.5     │ 0.01       │ 0            │ 0.3                   │ 3.81         │ 0.0                  │
│ 8   │ 2        │ 2019-12-18 15:27:49  │ 2019-12-18 15:28:59   │ 1               │ 0.0           │ 5          │ N                  │ 193          │ 193          │ 1            │ 0.01        │ 0.0     │ 0.0     │ 0.0        │ 0            │ 0.3                   │ 2.81         │ 2.5                  │
│ 9   │ 2        │ 2019-12-18 15:30:35  │ 2019-12-18 15:31:35   │ 4               │ 0.0           │ 1          │ N                  │ 193          │ 193          │ 1            │ 2.5         │ 0.5     │ 0.5     │ 0.0        │ 0            │ 0.3                   │ 6.3          │ 2.5                  │
</code></pre>
<p>Yellow and Green taxi data have different set of columns. It may be convenient to separate them out into two trees. There are several ways to do this, they are all correct.</p>
<pre><code class="julia hljs"><span class="hljs-comment"># method 1</span>

yellow = dfs[<span class="hljs-string">glob&quot;*/*/yellow.csv&quot;</span>]
green = dfs[<span class="hljs-string">glob&quot;*/*/green.csv&quot;</span>];</code></pre>
<p>Here we used a <a href="https://linux.die.net/man/3/glob">glob</a> expression constructed with the <code>glob&quot;&quot;</code> string macro. This macro is provided by <a href="https://github.com/vtjnash/Glob.jl">Glob.jl</a> and is re-exported by FileTrees.</p>
<pre><code class="julia hljs"><span class="hljs-comment"># method 2</span>

yellow = dfs[<span class="hljs-string">glob&quot;*/*/yellow.csv&quot;</span>]
green = diff(dfs, yellow);</code></pre><pre><code class="plaintext hljs">MethodError: no method matching diff(::FileTrees.FileTree, ::FileTrees.FileTree)
</code></pre>
<p><a href="api/#diff"><code>diff</code></a> allows you to &quot;subtract&quot; a tree structure from another. Here we have only yellow and green taxi files, so diff only leaves the green files behind.</p>
<p>Let&#39;s see how they look:</p>
<pre><code class="julia hljs"><span class="hljs-comment"># method 3</span>

yellow = dfs[<span class="hljs-string">r&quot;yellow.csv$&quot;</span>]
green = diff(dfs, yellow);</code></pre><pre><code class="plaintext hljs">MethodError: no method matching diff(::FileTrees.FileTree, ::FileTrees.FileTree)
</code></pre>
<p>Here we are indexing the tree with a regular expression. The regular expression in this case matches any path ending with the string &quot;yellow.csv&quot;.</p>
<p>All the above methods should return the exact same yellow and green trees:</p>
<pre><code class="julia hljs"><span class="hljs-meta">@show</span> yellow
<span class="hljs-meta">@show</span> green</code></pre><pre><code class="plaintext hljs">yellow = taxi-data/
├─ 2019/
│  ├─ 01/
│  │  └─ yellow.csv (9×18 DataFrame)
│  └─ 02/
│     └─ yellow.csv (9×18 DataFrame)
└─ 2020/
   ├─ 01/
   │  └─ yellow.csv (9×18 DataFrame)
   └─ 02/
      └─ yellow.csv (9×18 DataFrame)

green = taxi-data/
├─ 2019/
│  ├─ 01/
│  │  └─ green.csv (9×20 DataFrame)
│  └─ 02/
│     └─ green.csv (9×20 DataFrame)
└─ 2020/
   ├─ 01/
   │  └─ green.csv (9×20 DataFrame)
   └─ 02/
      └─ green.csv (9×20 DataFrame)

</code></pre>
<p>Here is a cool command to restructure the <code>yellow</code> tree to have one less level. You can&#39;t do this in the shell without a loop, but here we can use regular expressions.</p>
<p>See the <a href="patterns/">pattern matching</a> documentation to learn more about how to use pattern matching to manipulate trees.</p>
<h1 id="reducing_values_in_trees"><a href="#reducing_values_in_trees">reducing values in trees</a></h1>
<p>Now that we have files with the same schema in different trees,  we can reduce either tree with <code>vcat</code> function on DataFrames to combine the dataframes into a single dataframe:</p>
<pre><code class="julia hljs">yellowdf = reducevalues(vcat, yellow)

first(yellowdf, <span class="hljs-number">15</span>)</code></pre><pre><code class="plaintext hljs">15×18 DataFrame
│ Row │ VendorID │ tpep_pickup_datetime │ tpep_dropoff_datetime │ passenger_count │ trip_distance │ RatecodeID │ store_and_fwd_flag │ PULocationID │ DOLocationID │ payment_type │ fare_amount │ extra   │ mta_tax │ tip_amount │ tolls_amount │ improvement_surcharge │ total_amount │ congestion_surcharge │
│     │ Int64    │ String               │ String                │ Int64           │ Float64       │ Int64      │ String             │ Int64        │ Int64        │ Int64        │ Float64     │ Float64 │ Float64 │ Float64    │ Float64      │ Float64               │ Float64      │ Float64?             │
├─────┼──────────┼──────────────────────┼───────────────────────┼─────────────────┼───────────────┼────────────┼────────────────────┼──────────────┼──────────────┼──────────────┼─────────────┼─────────┼─────────┼────────────┼──────────────┼───────────────────────┼──────────────┼──────────────────────┤
│ 1   │ 1        │ 2019-01-01 00:46:40  │ 2019-01-01 00:53:20   │ 1               │ 1.5           │ 1          │ N                  │ 151          │ 239          │ 1            │ 7.0         │ 0.5     │ 0.5     │ 1.65       │ 0.0          │ 0.3                   │ 9.95         │ missing              │
│ 2   │ 1        │ 2019-01-01 00:59:47  │ 2019-01-01 01:18:59   │ 1               │ 2.6           │ 1          │ N                  │ 239          │ 246          │ 1            │ 14.0        │ 0.5     │ 0.5     │ 1.0        │ 0.0          │ 0.3                   │ 16.3         │ missing              │
│ 3   │ 2        │ 2018-12-21 13:48:30  │ 2018-12-21 13:52:40   │ 3               │ 0.0           │ 1          │ N                  │ 236          │ 236          │ 1            │ 4.5         │ 0.5     │ 0.5     │ 0.0        │ 0.0          │ 0.3                   │ 5.8          │ missing              │
│ 4   │ 2        │ 2018-11-28 15:52:25  │ 2018-11-28 15:55:45   │ 5               │ 0.0           │ 1          │ N                  │ 193          │ 193          │ 2            │ 3.5         │ 0.5     │ 0.5     │ 0.0        │ 0.0          │ 0.3                   │ 7.55         │ missing              │
│ 5   │ 2        │ 2018-11-28 15:56:57  │ 2018-11-28 15:58:33   │ 5               │ 0.0           │ 2          │ N                  │ 193          │ 193          │ 2            │ 52.0        │ 0.0     │ 0.5     │ 0.0        │ 0.0          │ 0.3                   │ 55.55        │ missing              │
│ 6   │ 2        │ 2018-11-28 16:25:49  │ 2018-11-28 16:28:26   │ 5               │ 0.0           │ 1          │ N                  │ 193          │ 193          │ 2            │ 3.5         │ 0.5     │ 0.5     │ 0.0        │ 5.76         │ 0.3                   │ 13.31        │ missing              │
│ 7   │ 2        │ 2018-11-28 16:29:37  │ 2018-11-28 16:33:43   │ 5               │ 0.0           │ 2          │ N                  │ 193          │ 193          │ 2            │ 52.0        │ 0.0     │ 0.5     │ 0.0        │ 0.0          │ 0.3                   │ 55.55        │ missing              │
│ 8   │ 1        │ 2019-01-01 00:21:28  │ 2019-01-01 00:28:37   │ 1               │ 1.3           │ 1          │ N                  │ 163          │ 229          │ 1            │ 6.5         │ 0.5     │ 0.5     │ 1.25       │ 0.0          │ 0.3                   │ 9.05         │ missing              │
│ 9   │ 1        │ 2019-01-01 00:32:01  │ 2019-01-01 00:45:39   │ 1               │ 3.7           │ 1          │ N                  │ 229          │ 7            │ 1            │ 13.5        │ 0.5     │ 0.5     │ 3.7        │ 0.0          │ 0.3                   │ 18.5         │ missing              │
│ 10  │ 1        │ 2019-02-01 00:59:04  │ 2019-02-01 01:07:27   │ 1               │ 2.1           │ 1          │ N                  │ 48           │ 234          │ 1            │ 9.0         │ 0.5     │ 0.5     │ 2.0        │ 0.0          │ 0.3                   │ 12.3         │ 0.0                  │
│ 11  │ 1        │ 2019-02-01 00:33:09  │ 2019-02-01 01:03:58   │ 1               │ 9.8           │ 1          │ N                  │ 230          │ 93           │ 2            │ 32.0        │ 0.5     │ 0.5     │ 0.0        │ 0.0          │ 0.3                   │ 33.3         │ 0.0                  │
│ 12  │ 1        │ 2019-02-01 00:09:03  │ 2019-02-01 00:09:16   │ 1               │ 0.0           │ 1          │ N                  │ 145          │ 145          │ 2            │ 2.5         │ 0.5     │ 0.5     │ 0.0        │ 0.0          │ 0.3                   │ 3.8          │ 0.0                  │
│ 13  │ 1        │ 2019-02-01 00:45:38  │ 2019-02-01 00:51:10   │ 1               │ 0.8           │ 1          │ N                  │ 95           │ 95           │ 2            │ 5.5         │ 0.5     │ 0.5     │ 0.0        │ 0.0          │ 0.3                   │ 6.8          │ 0.0                  │
│ 14  │ 1        │ 2019-02-01 00:25:30  │ 2019-02-01 00:28:14   │ 1               │ 0.8           │ 1          │ N                  │ 140          │ 263          │ 2            │ 5.0         │ 0.5     │ 0.5     │ 0.0        │ 0.0          │ 0.3                   │ 6.3          │ 0.0                  │
│ 15  │ 1        │ 2019-02-01 00:38:02  │ 2019-02-01 00:40:57   │ 1               │ 0.8           │ 1          │ N                  │ 229          │ 141          │ 2            │ 4.5         │ 0.5     │ 0.5     │ 0.0        │ 0.0          │ 0.3                   │ 5.8          │ 0.0                  │</code></pre>
<p><code>reducevalues</code> also works on the lazy tree but returns a lazy final result. You can call <code>exec</code> on it to actually compute it. This causes the computation to occur in parallel&#33;</p>
<pre><code class="julia hljs">yellowdf = exec(reducevalues(vcat, lazy_dfs[<span class="hljs-string">r&quot;yellow.csv$&quot;</span>]))

first(yellowdf, <span class="hljs-number">15</span>)</code></pre><pre><code class="plaintext hljs">15×18 DataFrame
│ Row │ VendorID │ tpep_pickup_datetime │ tpep_dropoff_datetime │ passenger_count │ trip_distance │ RatecodeID │ store_and_fwd_flag │ PULocationID │ DOLocationID │ payment_type │ fare_amount │ extra   │ mta_tax │ tip_amount │ tolls_amount │ improvement_surcharge │ total_amount │ congestion_surcharge │
│     │ Int64    │ String               │ String                │ Int64           │ Float64       │ Int64      │ String             │ Int64        │ Int64        │ Int64        │ Float64     │ Float64 │ Float64 │ Float64    │ Float64      │ Float64               │ Float64      │ Float64?             │
├─────┼──────────┼──────────────────────┼───────────────────────┼─────────────────┼───────────────┼────────────┼────────────────────┼──────────────┼──────────────┼──────────────┼─────────────┼─────────┼─────────┼────────────┼──────────────┼───────────────────────┼──────────────┼──────────────────────┤
│ 1   │ 1        │ 2019-01-01 00:46:40  │ 2019-01-01 00:53:20   │ 1               │ 1.5           │ 1          │ N                  │ 151          │ 239          │ 1            │ 7.0         │ 0.5     │ 0.5     │ 1.65       │ 0.0          │ 0.3                   │ 9.95         │ missing              │
│ 2   │ 1        │ 2019-01-01 00:59:47  │ 2019-01-01 01:18:59   │ 1               │ 2.6           │ 1          │ N                  │ 239          │ 246          │ 1            │ 14.0        │ 0.5     │ 0.5     │ 1.0        │ 0.0          │ 0.3                   │ 16.3         │ missing              │
│ 3   │ 2        │ 2018-12-21 13:48:30  │ 2018-12-21 13:52:40   │ 3               │ 0.0           │ 1          │ N                  │ 236          │ 236          │ 1            │ 4.5         │ 0.5     │ 0.5     │ 0.0        │ 0.0          │ 0.3                   │ 5.8          │ missing              │
│ 4   │ 2        │ 2018-11-28 15:52:25  │ 2018-11-28 15:55:45   │ 5               │ 0.0           │ 1          │ N                  │ 193          │ 193          │ 2            │ 3.5         │ 0.5     │ 0.5     │ 0.0        │ 0.0          │ 0.3                   │ 7.55         │ missing              │
│ 5   │ 2        │ 2018-11-28 15:56:57  │ 2018-11-28 15:58:33   │ 5               │ 0.0           │ 2          │ N                  │ 193          │ 193          │ 2            │ 52.0        │ 0.0     │ 0.5     │ 0.0        │ 0.0          │ 0.3                   │ 55.55        │ missing              │
│ 6   │ 2        │ 2018-11-28 16:25:49  │ 2018-11-28 16:28:26   │ 5               │ 0.0           │ 1          │ N                  │ 193          │ 193          │ 2            │ 3.5         │ 0.5     │ 0.5     │ 0.0        │ 5.76         │ 0.3                   │ 13.31        │ missing              │
│ 7   │ 2        │ 2018-11-28 16:29:37  │ 2018-11-28 16:33:43   │ 5               │ 0.0           │ 2          │ N                  │ 193          │ 193          │ 2            │ 52.0        │ 0.0     │ 0.5     │ 0.0        │ 0.0          │ 0.3                   │ 55.55        │ missing              │
│ 8   │ 1        │ 2019-01-01 00:21:28  │ 2019-01-01 00:28:37   │ 1               │ 1.3           │ 1          │ N                  │ 163          │ 229          │ 1            │ 6.5         │ 0.5     │ 0.5     │ 1.25       │ 0.0          │ 0.3                   │ 9.05         │ missing              │
│ 9   │ 1        │ 2019-01-01 00:32:01  │ 2019-01-01 00:45:39   │ 1               │ 3.7           │ 1          │ N                  │ 229          │ 7            │ 1            │ 13.5        │ 0.5     │ 0.5     │ 3.7        │ 0.0          │ 0.3                   │ 18.5         │ missing              │
│ 10  │ 1        │ 2019-02-01 00:59:04  │ 2019-02-01 01:07:27   │ 1               │ 2.1           │ 1          │ N                  │ 48           │ 234          │ 1            │ 9.0         │ 0.5     │ 0.5     │ 2.0        │ 0.0          │ 0.3                   │ 12.3         │ 0.0                  │
│ 11  │ 1        │ 2019-02-01 00:33:09  │ 2019-02-01 01:03:58   │ 1               │ 9.8           │ 1          │ N                  │ 230          │ 93           │ 2            │ 32.0        │ 0.5     │ 0.5     │ 0.0        │ 0.0          │ 0.3                   │ 33.3         │ 0.0                  │
│ 12  │ 1        │ 2019-02-01 00:09:03  │ 2019-02-01 00:09:16   │ 1               │ 0.0           │ 1          │ N                  │ 145          │ 145          │ 2            │ 2.5         │ 0.5     │ 0.5     │ 0.0        │ 0.0          │ 0.3                   │ 3.8          │ 0.0                  │
│ 13  │ 1        │ 2019-02-01 00:45:38  │ 2019-02-01 00:51:10   │ 1               │ 0.8           │ 1          │ N                  │ 95           │ 95           │ 2            │ 5.5         │ 0.5     │ 0.5     │ 0.0        │ 0.0          │ 0.3                   │ 6.8          │ 0.0                  │
│ 14  │ 1        │ 2019-02-01 00:25:30  │ 2019-02-01 00:28:14   │ 1               │ 0.8           │ 1          │ N                  │ 140          │ 263          │ 2            │ 5.0         │ 0.5     │ 0.5     │ 0.0        │ 0.0          │ 0.3                   │ 6.3          │ 0.0                  │
│ 15  │ 1        │ 2019-02-01 00:38:02  │ 2019-02-01 00:40:57   │ 1               │ 0.8           │ 1          │ N                  │ 229          │ 141          │ 2            │ 4.5         │ 0.5     │ 0.5     │ 0.0        │ 0.0          │ 0.3                   │ 5.8          │ 0.0                  │</code></pre>
<p>Note that in the lazy case the green csv files are never loaded since they are not required to compute the final result&#33;</p>
<h1 id="saving_to_a_directory"><a href="#saving_to_a_directory">Saving to a directory</a></h1>
<pre><code class="julia hljs">df1 = dfs[<span class="hljs-string">r&quot;yellow.csv$&quot;</span>]

<span class="hljs-comment"># this mv moves X/Y/yellow.csv to yellow/X/Y.csv</span>
<span class="hljs-comment"># see the Tree manipulation section of the docs for more</span>

df2 = mv(df1, <span class="hljs-string">r&quot;^([^/]*)/([^/]*)/yellow.csv$&quot;</span>,
              <span class="hljs-string">s&quot;yellow/\1/\2.csv&quot;</span>)[<span class="hljs-string">&quot;yellow&quot;</span>]

<span class="hljs-meta">@show</span> df2

FileTrees.save(setparent(df2, <span class="hljs-literal">nothing</span>)) <span class="hljs-keyword">do</span> file
    CSV.write(path(file), file[])
<span class="hljs-keyword">end</span></code></pre><pre><code class="plaintext hljs">df2 = yellow/
├─ 2019/
│  ├─ 01.csv (9×18 DataFrame)
│  └─ 02.csv (9×18 DataFrame)
└─ 2020/
   ├─ 01.csv (9×18 DataFrame)
   └─ 02.csv (9×18 DataFrame)

</code></pre>
<p>It&#39;s saved&#33;</p>
<pre><code class="julia hljs"><span class="hljs-comment"># let&#x27;s read back the new directory</span>
FileTree(<span class="hljs-string">&quot;yellow&quot;</span>)</code></pre><pre><code class="plaintext hljs">yellow/
├─ 2019/
│  ├─ 01.csv
│  └─ 02.csv
└─ 2020/
   ├─ 01.csv
   └─ 02.csv
</code></pre>

<p>Happy Hacking&#33;</p>
<div class="page-foot">
  <div class="copyright">
    &copy; Shashi Gowda, Julian Samaroo. Last modified: August 11, 2020. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a>.
  </div>
</div>
</div><!-- CONTENT ENDS HERE -->
    </div>  <!-- div: content container -->
    
    
        


    
  </body>
</html>
