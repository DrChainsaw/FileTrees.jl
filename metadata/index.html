<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
   <link rel="stylesheet" href="/FileTrees.jl/libs/highlight/github.min.css">
   
  <link rel="stylesheet" href="/FileTrees.jl/css/franklin.css">
<link rel="stylesheet" href="/FileTrees.jl/css/poole_hyde.css">
<link rel="stylesheet" href="/FileTrees.jl/css/custom.css">
<!-- style adjustments -->
<style>
  html {font-size: 17px;}
  .franklin-content {position: relative; padding-left: 8%; padding-right: 5%; line-height: 1.35em;}
  @media (min-width: 940px) {
    .franklin-content {width: 100%; margin-left: auto; margin-right: auto;}
  }
  @media (max-width: 768px) {
    .franklin-content {padding-left: 6%; padding-right: 6%;}
  }
</style>
<link rel="icon" href="/FileTrees.jl/assets/favicon.png">

   <title>FileTrees.jl</title>  
</head>
<body>
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1 style="font-size:2em"><a href="/FileTrees.jl/">FileTrees<span style="opacity:0.4">.jl</span></a></h1>
      <p class="lead">Easy everyday parallelism with a file tree abstraction</p>
    </div>
    <style>
@media (min-width: 768px) {
    .sidebar-nav {
        margin-top: 1.5em;
    }
}
    .sidebar-nav .sidebar-nav-item.active {
        box-sizing: border-box;
        border-bottom: 1px #f1f1f1 solid;
        margin-right: -1em;
        margin-left: -0.5em;
        padding-left: 0.5em;
        color: white;
        font-weight: normal !important;
    }
    .sidebar-nav .sidebar-nav-item {
        color: #cccccc;
        margin: 0.25em 0;
    }
    </style>
    <nav class="sidebar-nav" style="opacity: 0.9">
      <a class="sidebar-nav-item " href="/FileTrees.jl/">Getting started</a>
      <a class="sidebar-nav-item " href="/FileTrees.jl/values/">Values in file trees</a>
      <a class="sidebar-nav-item " href="/FileTrees.jl/tree-manipulation/">Manipulating file trees</a>
      <a class="sidebar-nav-item " href="/FileTrees.jl/lazy-parallel/">Laziness and parallelism</a>
      <a class="sidebar-nav-item " href="/FileTrees.jl/api/">API documentation</a>
      <small>EXTRAS</small>
      <a class="sidebar-nav-item active" href="/FileTrees.jl/metadata/">Working with metadata</a>
      <a class="sidebar-nav-item " href="/FileTrees.jl/patterns/">Pattern matching</a>
      <a class="sidebar-nav-item " href="/FileTrees.jl/create-trees/">Creating file trees from scratch</a>
      <a class="sidebar-nav-item " href="/FileTrees.jl/images/">Example: Images</a>
    </nav>

  </div>
  <div style="font-size: 0.85em; bottom: 3em; position: fixed">
      <a href="https://github.com/shashi/FileTrees.jl">Go to GitHub repository &rarr;</a> <br>  <br>

      <a href="https://julialang.org/"><img src="https://raw.githubusercontent.com/JuliaLang/julia-logo-graphics/master/images/julia-logo-dark.svg" height="32" style="display: inline-block; margin-bottom: -8px; opacity: 0.7">
          powered.</a>
  </div>
</div>
<div class="content container">

<!-- Content appended here -->
<div class="franklin-content"><h1 id="working_with_metadata"><a href="#working_with_metadata">Working with metadata</a></h1>
<p style="font-size: 1.15em; color: #333; line-height:1.5em"> Metadata of trees are other trees with the same structure</p>
<p>FileTrees only allow you to store one value per node, but sometimes you also want to have metadata that is small and has information about the contents of the files.</p>
<p>In FileTrees, you can create a new tree which contains the metadata&#33; This tree can mirror the structure of the tree with the actual data. You can operate on the metadata tree, for example, to filter out nodes based on the metadata, and then <em>index into the tree with the actual data with the metadata tree</em> to apply the same filtering.</p>
<p>In the taxi dataset we may want to have metadata about what are the RatecodeId present in each file:</p>
<pre><code class="julia hljs"><span class="hljs-keyword">using</span> FileTrees, DataFrames, CSV

taxi_dir = FileTree(<span class="hljs-string">&quot;taxi-data&quot;</span>)

<span class="hljs-comment"># Lazy-load the data</span>
data = FileTrees.load(taxi_dir;lazy=<span class="hljs-literal">true</span>) <span class="hljs-keyword">do</span> file
    DataFrame(CSV.File(path(file)))
<span class="hljs-keyword">end</span>


<span class="hljs-comment"># Get the metadata</span>
metadata = mapvalues(data) <span class="hljs-keyword">do</span> df
    (unique(df.RatecodeID)...,)
<span class="hljs-keyword">end</span> |&gt; exec</code></pre><pre><code class="plaintext hljs">taxi-data/
├─ 2019/
│  ├─ 01/
│  │  ├─ green.csv ((1,))
│  │  └─ yellow.csv ((1, 2))
│  └─ 02/
│     ├─ green.csv ((1,))
│     └─ yellow.csv ((1,))
└─ 2020/
   ├─ 01/
   │  ├─ green.csv ((1, 5))
   │  └─ yellow.csv ((1, 5))
   └─ 02/
      ├─ green.csv ((1,))
      └─ yellow.csv ((1,))
</code></pre>
<p>Once this metadata is created, you can store the tree in a JLD2 file, and read it back often. Or you can also store it in a new file in the same directory.</p>
<p>Now let&#39;s say you want to load only the data for files which contain the RetecodeID 5.</p>
<p>First we work on the metadata tree to filter it thus:</p>
<pre><code class="julia hljs">only_5 = filter(x-&gt;FileTrees.hasvalue(x) &amp;&amp; (<span class="hljs-number">5</span> <span class="hljs-keyword">in</span> x[]), metadata, dirs=<span class="hljs-literal">false</span>)</code></pre><pre><code class="plaintext hljs">taxi-data/
├─ 2019/
│  ├─ 01/
│  └─ 02/
└─ 2020/
   ├─ 01/
   │  ├─ green.csv ((1, 5))
   │  └─ yellow.csv ((1, 5))
   └─ 02/
</code></pre>
<p>You can now &quot;index&quot; into the data to get only files with this structure.</p>
<pre><code class="julia hljs">data[only_5]</code></pre><pre><code class="plaintext hljs">taxi-data/
└─ 2020/
   └─ 01/
      ├─ green.csv (Thunk(#1, (File(taxi-data/2020/01/green.csv),)))
      └─ yellow.csv (Thunk(#1, (File(taxi-data/2020/01/yellow.csv),)))
</code></pre>
<h1 id="conclusion"><a href="#conclusion">Conclusion</a></h1>
<p>So the way to deal with metadata is: to create a tree with the metadata, filter that tree based on the metadata, then index into the data tree with the filtered tree&#33;</p>
<div class="page-foot">
  <div class="copyright">
    &copy; Shashi Gowda, Julian Samaroo. Last modified: August 13, 2020. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a>.
  </div>
</div>
</div><!-- CONTENT ENDS HERE -->
    </div>  <!-- div: content container -->
    
    <script>
        var els =  document.querySelectorAll(".language-julia")
        for (var i=0, l = els.length; i < l; i++) {
            var el = els[i]
            var out = el.parentNode.nextSibling
            if (out.tagName === "PRE") {
                out.className = out.className + " code-output"
            }
        }
    </script>
    
        


    
  </body>
</html>
